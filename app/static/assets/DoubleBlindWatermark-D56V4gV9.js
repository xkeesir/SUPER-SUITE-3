import{_ as N,r as i,p as A,D as q,c as o,a as t,d as j,g as v,e as I,v as U,t as B,F as $,h as z,j as H,o as r}from"./index-CHdk52Yy.js";const X={class:"h-full flex flex-col p-6 space-y-6 overflow-y-auto"},Z={class:"grid grid-cols-1 lg:grid-cols-12 gap-6"},G={class:"lg:col-span-4 space-y-6"},J={class:"bg-slate-800/50 border border-slate-700 rounded-lg p-5"},K={class:"space-y-4"},Q={key:0,class:"grid grid-cols-2 gap-2 mt-2"},Y={key:0,class:"relative group"},ee=["src"],te={key:1,class:"relative group"},se=["src"],le={class:"bg-slate-800/50 border border-slate-700 rounded-lg p-5"},ae={class:"grid grid-cols-2 gap-4"},oe=["disabled"],re={key:0,class:"animate-spin mr-2"},ne={key:1,class:"mr-2"},ie={class:"bg-slate-800/50 border border-slate-700 rounded-lg p-5"},de={class:"grid grid-cols-1 gap-3"},ce=["disabled"],ue={class:"lg:col-span-8 space-y-6"},pe={key:0,class:"bg-red-900/20 border border-red-500/50 text-red-400 p-4 rounded text-sm font-mono"},ve={key:1,class:"bg-slate-800 border border-purple-500/30 rounded-lg overflow-hidden animate-fade-in"},ge={class:"bg-slate-900/80 px-4 py-2 border-b border-purple-500/30 flex justify-between items-center"},be=["href"],fe={class:"p-4 flex justify-center bg-[url('/assets/grid.svg')] min-h-[300px]"},me=["src"],xe={key:2,class:"space-y-4"},he={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ye={class:"px-3 py-1.5 bg-slate-900 border-b border-slate-700 flex justify-between items-center"},_e={class:"text-xs font-mono text-cyan-300 truncate pr-2"},we={class:"text-[10px] py-0.5 px-1.5 rounded bg-slate-700 text-slate-300"},ke={class:"aspect-square bg-slate-950 relative flex items-center justify-center overflow-hidden"},Re=["src","onClick"],De={key:3,class:"h-64 flex flex-col items-center justify-center text-slate-600 border-2 border-dashed border-slate-800 rounded-lg"},Ce={__name:"DoubleBlindWatermark",setup(je){const k=i(null),R=i(null),D=i(null),C=i(null),y=i(null),_=i(null),c=i(!1),m=i(""),d=i(""),w=A(()=>k.value&&R.value&&D.value&&C.value),u=i(null),p=i([]),g=q({seed:20160930,alpha:3}),F=async(s,e)=>{const l=e.target.files[0];if(l)try{s==="target"?k.value=l:R.value=l;const n=URL.createObjectURL(l);s==="target"?y.value=n:_.value=n;const a=await createImageBitmap(l,{colorSpaceConversion:"none",premultiplyAlpha:"none",imageOrientation:"none"});s==="target"?D.value=a:C.value=a,s==="target"&&(p.value=[],u.value=null)}catch(n){d.value="Bitmap load error: "+n.message}},M=async()=>{if(!w.value)return;c.value=!0,m.value="server",d.value="",u.value=null;const s=new FormData;s.append("target",k.value),s.append("original",R.value),s.append("seed",g.seed),s.append("alpha",g.alpha);try{const l=await(await fetch("/api/bwm",{method:"POST",body:s})).json();l.status==="success"?u.value=l.image:d.value=l.message||"Server extraction failed"}catch(e){d.value="Network error: "+e.message}finally{c.value=!1,m.value=""}},E=(s,e,l)=>{e=e||s.width,l=l||s.height;const a=new OffscreenCanvas(e,l).getContext("2d",{willReadFrequently:!0});return a.drawImage(s,0,0,e,l),a.getImageData(0,0,e,l)},S=async()=>{w.value&&(c.value=!0,m.value="client",d.value="",p.value=[],await H(),setTimeout(()=>{try{const s=E(D.value),e=E(C.value,s.width,s.height),l=O(s,e,(a,b)=>{let x=a^b;return x>0?x*50:0});p.value.push({title:"Bitwise XOR (Enhanced)",tag:"DIFF",url:l});const n=O(s,e,(a,b)=>Math.abs(a-b)*20);p.value.push({title:"Absolute Difference",tag:"DIFF",url:n})}catch(s){d.value="Client Error: "+s.message}finally{c.value=!1,m.value=""}},50))};function O(s,e,l){const n=s.width,a=s.height,b=new ImageData(n,a),x=s.data,W=e.data,T=b.data;for(let f=0;f<x.length;f+=4){for(let h=0;h<3;h++){let P=l(x[f+h],W[f+h]);T[f+h]=Math.min(255,P)}T[f+3]=255}return V(b)}function V(s){const e=document.createElement("canvas");return e.width=s.width,e.height=s.height,e.getContext("2d").putImageData(s,0,0),e.toDataURL()}const L=s=>{window.open("").document.write(`<body style="margin:0;background:#111;display:flex;justify-content:center;align-items:center;height:100vh;">
    <img src="${s}" style="max-width:100%;max-height:100%;border:1px solid #333;image-rendering:pixelated">
  </body>`)};return(s,e)=>(r(),o("div",X,[e[15]||(e[15]=t("div",{class:"flex justify-between items-end border-b border-slate-700 pb-4"},[t("div",null,[t("h1",{class:"text-3xl font-bold text-cyan-400 tracking-tighter"},[t("span",{class:"text-green-500"},"è¶…çº§"),j(" åŒå›¾éšå†™åˆ†æž ")])])],-1)),t("div",Z,[t("div",G,[t("div",J,[t("div",K,[t("div",null,[e[4]||(e[4]=t("label",{class:"block text-xs text-slate-400 mb-1"},"éšå†™å›¾ *",-1)),t("input",{type:"file",onChange:e[0]||(e[0]=l=>F("target",l)),accept:"image/*",class:"block w-full text-sm text-slate-300 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-slate-700 file:text-cyan-400 hover:file:bg-slate-600 cursor-pointer"},null,32)]),t("div",null,[e[5]||(e[5]=t("label",{class:"block text-xs text-slate-400 mb-1"},"åŽŸå›¾ *",-1)),t("input",{type:"file",onChange:e[1]||(e[1]=l=>F("original",l)),accept:"image/*",class:"block w-full text-sm text-slate-300 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-slate-700 file:text-cyan-400 hover:file:bg-slate-600 cursor-pointer"},null,32)]),y.value||_.value?(r(),o("div",Q,[y.value?(r(),o("div",Y,[t("img",{src:y.value,class:"h-24 w-full object-cover rounded border border-cyan-500/30"},null,8,ee),e[6]||(e[6]=t("span",{class:"absolute bottom-0 left-0 bg-black/70 text-xs px-1 text-cyan-400"},"Target",-1))])):v("",!0),_.value?(r(),o("div",te,[t("img",{src:_.value,class:"h-24 w-full object-cover rounded border border-green-500/30"},null,8,se),e[7]||(e[7]=t("span",{class:"absolute bottom-0 left-0 bg-black/70 text-xs px-1 text-green-400"},"Original",-1))])):v("",!0)])):v("",!0)])]),t("div",le,[t("div",ae,[t("div",null,[e[8]||(e[8]=t("label",{class:"block text-xs text-slate-400 mb-1"},"éšæœºç§å­ï¼ˆå»ºè®®ä¸è¦ä¿®æ”¹ï¼‰",-1)),I(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>g.seed=l),type:"number",class:"w-full bg-slate-900 border border-slate-600 rounded px-2 py-1 text-cyan-400 font-mono focus:outline-none focus:border-cyan-400"},null,512),[[U,g.seed]])]),t("div",null,[e[9]||(e[9]=t("label",{class:"block text-xs text-slate-400 mb-1"},"é€šé“",-1)),I(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>g.alpha=l),type:"number",step:"0.1",class:"w-full bg-slate-900 border border-slate-600 rounded px-2 py-1 text-cyan-400 font-mono focus:outline-none focus:border-cyan-400"},null,512),[[U,g.alpha]])])]),t("button",{onClick:M,disabled:!w.value||c.value,class:"w-full mt-4 py-2 px-4 bg-purple-600/20 hover:bg-purple-600/40 text-purple-400 border border-purple-500/50 rounded transition-all flex justify-center items-center disabled:opacity-50 disabled:cursor-not-allowed"},[c.value&&m.value==="server"?(r(),o("span",re,"âŸ³")):(r(),o("span",ne,"ðŸš€")),e[10]||(e[10]=j(" å¼€å§‹BWMåˆ†æž ",-1))],8,oe)]),t("div",ie,[t("div",de,[t("button",{onClick:S,disabled:!w.value||c.value,class:"w-full py-2 px-4 bg-cyan-600/20 hover:bg-cyan-600/40 text-cyan-400 border border-cyan-500/50 rounded transition-all flex justify-center items-center disabled:opacity-50"},[...e[11]||(e[11]=[t("span",{class:"mr-2"},"âš¡",-1),j("å¼€å§‹å¼‚æˆ–åˆ†æž ",-1)])],8,ce)])])]),t("div",ue,[d.value?(r(),o("div",pe," [ERROR]: "+B(d.value),1)):v("",!0),u.value?(r(),o("div",ve,[t("div",ge,[e[12]||(e[12]=t("span",{class:"text-purple-400 font-mono font-bold text-sm"},"SERVER_OUTPUT // BWM_RECOVER",-1)),t("a",{href:u.value,download:"server_bwm_result.png",class:"text-xs text-slate-400 hover:text-white"},"[Download]",8,be)]),t("div",fe,[t("img",{src:u.value,class:"max-h-[500px] border-2 border-slate-700 shadow-2xl image-pixelated"},null,8,me)])])):v("",!0),p.value.length>0?(r(),o("div",xe,[e[13]||(e[13]=t("div",{class:"flex items-center space-x-2"},[t("div",{class:"h-px bg-slate-700 flex-1"}),t("span",{class:"text-slate-500 font-mono text-xs"},"LOCAL_DIFFERENCE_RESULTS"),t("div",{class:"h-px bg-slate-700 flex-1"})],-1)),t("div",he,[(r(!0),o($,null,z(p.value,(l,n)=>(r(),o("div",{key:n,class:"bg-slate-800 border border-slate-700 rounded overflow-hidden group hover:border-cyan-500/50 transition-colors"},[t("div",ye,[t("span",_e,B(l.title),1),t("span",we,B(l.tag),1)]),t("div",ke,[t("img",{src:l.url,class:"max-w-full max-h-full object-contain image-pixelated cursor-zoom-in",onClick:a=>L(l.url)},null,8,Re)])]))),128))])])):v("",!0),!u.value&&p.value.length===0?(r(),o("div",De,[...e[14]||(e[14]=[t("svg",{class:"w-12 h-12 mb-2 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"})],-1),t("span",{class:"font-mono text-sm opacity-50"},"Waiting for TWO images...",-1)])])):v("",!0)])])]))}},Fe=N(Ce,[["__scopeId","data-v-35fd7f09"]]);export{Fe as default};
