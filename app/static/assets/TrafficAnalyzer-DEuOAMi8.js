import{c as a,a as e,o,_ as F,r as d,k as O,p as Z,b as P,u as b,e as z,A as I,v as K,n as c,q as k,t as n,J as M,g as y,F as B,h as E,d as X}from"./index-BRrIxQ47.js";import{r as G}from"./LockOpenIcon-BdYgG8Hx.js";function J(v,i){return o(),a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 16.5V9.75m0 0 3 3m-3-3-3 3M6.75 19.5a4.5 4.5 0 0 1-1.41-8.775 5.25 5.25 0 0 1 10.233-2.33 3 3 0 0 1 3.758 3.848A3.752 3.752 0 0 1 18 19.5H6.75Z"})])}function H(v,i){return o(),a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.042 21.672 13.684 16.6m0 0-2.51 2.225.569-9.47 5.227 7.917-3.286-.672Zm-7.518-.267A8.25 8.25 0 1 1 20.25 10.5M8.288 14.212A5.25 5.25 0 1 1 17.25 10.5"})])}function W(v,i){return o(),a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88"})])}function Q(v,i){return o(),a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})])}const Y={class:"h-full flex flex-col gap-4"},ee={class:"bg-cyber-panel border border-slate-700 rounded-xl p-4 shadow-lg flex flex-wrap gap-4 items-center justify-between"},te={class:"flex-shrink-0"},se={class:"relative group"},le={class:"flex items-center gap-2 bg-blue-600 hover:bg-blue-500 text-white px-5 py-2.5 rounded-lg transition-all font-bold text-sm shadow-blue-900/50 shadow-lg"},oe={class:"flex-1 flex justify-center min-w-[300px]"},ae={class:"flex items-center gap-4 bg-slate-900/60 px-6 py-2 rounded-xl border border-slate-700/50 shadow-inner"},ne={class:"flex items-center gap-3"},re={class:"flex flex-col gap-0.5"},de={class:"flex flex-col gap-0.5"},ie={class:"relative"},ce={class:"flex items-center gap-4 flex-shrink-0"},ue={class:"text-slate-500 text-xs font-mono text-right min-w-[80px]"},pe={key:0,class:"flex flex-col items-end leading-tight"},xe={class:"text-blue-400 font-bold text-sm"},fe={key:1},be={class:"flex-1 overflow-auto custom-scrollbar"},ve={class:"w-full text-xs font-mono border-collapse"},he=["onClick"],ye=["title"],ge={class:"px-3 py-2 text-right text-slate-500"},we={key:0,class:"text-center py-10 text-slate-600 text-xs"},me={class:"flex-1 bg-cyber-panel border border-slate-700 rounded-xl flex flex-col overflow-hidden shadow-lg bg-[#0d1117] min-w-0"},_e={key:0,class:"flex flex-col h-full"},ke={class:"bg-slate-800/90 px-6 py-3 border-b border-slate-700 flex justify-between items-center backdrop-blur-sm z-20"},Ce={class:"flex items-center gap-3"},De={class:"text-sm font-mono text-slate-400"},je={key:0,class:"bg-purple-900/50 text-purple-200 px-2 py-0.5 rounded text-xs font-bold border border-purple-700/50"},Te={class:"text-xs text-slate-500 font-mono"},Pe={class:"flex-1 overflow-auto custom-scrollbar p-6 flex flex-col gap-6 relative"},ze={key:0,class:"absolute inset-0 bg-[#0d1117]/80 flex flex-col items-center justify-center z-10"},Me={class:"flex items-center gap-2 px-1 opacity-70"},Be={class:"text-[10px] font-mono text-slate-500 truncate max-w-[300px]"},Ee={class:"flex items-center justify-between px-3 py-1.5 bg-black/20 border-b border-white/5"},$e={class:"text-[10px] text-slate-500 font-mono flex gap-2"},Se=["onClick","disabled"],Ae={key:1,class:"w-3 h-3 border border-current border-t-transparent rounded-full animate-spin"},Le={key:0,class:"bg-blue-500/5 border-b border-white/5 p-3 animate-fade-in"},qe={class:"flex items-center gap-2 mb-2"},Re={class:"font-mono text-xs text-slate-300 whitespace-pre-wrap break-all leading-relaxed bg-black/30 p-2 rounded border border-white/10 max-h-[400px] overflow-auto custom-scrollbar select-text cursor-text selection:bg-blue-500/30"},Ve={class:"p-3 relative"},Ne={key:0,class:"absolute bottom-0 left-0 right-0 h-8 bg-gradient-to-t from-[#1c2128] to-transparent flex items-end justify-center pb-1"},Ue=["onClick"],Fe={key:2,class:"flex flex-col items-center justify-center h-full text-slate-600 gap-2"},Oe={key:1,class:"flex-1 flex flex-col items-center justify-center text-slate-600 gap-4"},Ze={class:"w-16 h-16 flex items-center justify-center"},Ie={__name:"TrafficAnalyzer",setup(v){const i=d([]),u=d(null),g=d(!1),w=d(!1),x=d([]),h=d("godzilla"),$=d("jsp"),f=d("key");O(h,l=>{l==="godzilla"?f.value="key":l==="behinder"&&(f.value="rebeyond")});const p=d(!0),m=Z(()=>p.value?i.value.filter(l=>l.method!=="TCP"):i.value),_=d(null),C=d(33.33),D=d(!1),S=()=>{D.value=!0,document.addEventListener("mousemove",j),document.addEventListener("mouseup",T),document.body.style.cursor="col-resize",document.body.style.userSelect="none"},j=l=>{if(!_.value)return;const s=_.value.getBoundingClientRect();let r=(l.clientX-s.left)/s.width*100;r<30&&(r=30),r>70&&(r=70),C.value=r},T=()=>{D.value=!1,document.removeEventListener("mousemove",j),document.removeEventListener("mouseup",T),document.body.style.cursor="",document.body.style.userSelect=""},A=async l=>{const s=l.target.files[0];if(!s)return;g.value=!0,i.value=[],u.value=null;const t=new FormData;t.append("file",s);try{const r=await fetch("/api/traffic/analyze",{method:"POST",body:t});r.ok&&(i.value=await r.json())}finally{g.value=!1}},L=async l=>{u.value=l,x.value=[],w.value=!0;try{const s=await fetch(`/api/traffic/stream_messages/${l.stream_id}`);if(s.ok){const t=await s.json();x.value=t.map(r=>({...r,isExpanded:!1,isDecrypting:!1,decryptedData:null}))}}finally{w.value=!1}},q=l=>{try{return l?atob(l):""}catch{return"[Binary Content]"}},R=async l=>{l.isDecrypting=!0,l.decryptedData=null;try{const t=await(await fetch("/api/traffic/decrypt_shell",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({payload_b64:l.raw_b64,tool:h.value,script_type:$.value,secret_key:f.value})})).json();t.status==="success"?(console.log(t.content),l.decryptedData=t.content,l.isExpanded=!1):l.decryptedData=[]}catch(s){console.error(s)}finally{l.isDecrypting=!1}},V=l=>({success:"bg-green-400",info:"bg-blue-400",warning:"bg-yellow-400",neutral:"bg-slate-400"})[l]||"bg-slate-400",N=l=>({success:"text-green-400",info:"text-blue-400",warning:"text-yellow-400",neutral:"text-slate-400"})[l]||"text-slate-400";return(l,s)=>(o(),a("div",Y,[e("div",ee,[e("div",te,[e("div",se,[e("button",le,[P(b(J),{class:"w-5 h-5"}),s[3]||(s[3]=e("span",null,"上传 PCAP",-1))]),e("input",{type:"file",accept:".pcap,.pcapng",onChange:A,class:"absolute inset-0 opacity-0 cursor-pointer"},null,32)])]),e("div",oe,[e("div",ae,[e("div",ne,[e("div",re,[s[5]||(s[5]=e("label",{class:"text-[10px] text-slate-400 font-bold uppercase tracking-wider pl-1"},"连接工具",-1)),z(e("select",{"onUpdate:modelValue":s[0]||(s[0]=t=>h.value=t),class:"bg-slate-800 border border-slate-600 text-white text-xs rounded px-2 py-1.5 focus:border-blue-500 outline-none w-40"},[...s[4]||(s[4]=[e("option",{value:"godzilla"},"哥斯拉 (Godzilla)",-1),e("option",{value:"behinder"},"冰蝎 (Behinder 4+)",-1)])],512),[[I,h.value]])])]),s[7]||(s[7]=e("div",{class:"w-[1px] h-8 bg-slate-700/80 mx-1"},null,-1)),e("div",de,[s[6]||(s[6]=e("label",{class:"text-[10px] text-yellow-600/80 font-bold uppercase tracking-wider pl-1"},"密钥 / 密码",-1)),e("div",ie,[z(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>f.value=t),type:"text",placeholder:"输入解密Key...",class:"bg-slate-800 border border-slate-600 text-yellow-400 text-xs rounded px-3 py-1.5 focus:border-yellow-500 outline-none w-60 font-mono shadow-sm"},null,512),[[K,f.value,void 0,{trim:!0}]])])])])]),e("div",ce,[e("button",{onClick:s[2]||(s[2]=t=>p.value=!p.value),class:c(["flex items-center gap-2 px-3 py-2 rounded-lg border transition-all text-xs font-bold shadow-sm",p.value?"bg-slate-800 text-slate-400 border-slate-700 hover:bg-slate-700 hover:text-slate-200":"bg-indigo-900/40 text-indigo-300 border-indigo-500/50 hover:bg-indigo-900/60"])},[p.value?(o(),k(b(W),{key:0,class:"w-4 h-4"})):(o(),k(b(Q),{key:1,class:"w-4 h-4"})),e("span",null,n(p.value?"隐藏未知 TCP":"显示未知 TCP"),1)],2),s[9]||(s[9]=e("div",{class:"h-8 w-[1px] bg-slate-700"},null,-1)),e("div",ue,[i.value.length?(o(),a("div",pe,[e("span",xe,n(m.value.length),1),s[8]||(s[8]=e("span",{class:"text-[10px] opacity-70"},"流数量",-1))])):(o(),a("span",fe,"无数据"))])])]),e("div",{class:"flex-1 flex min-h-0",ref_key:"containerRef",ref:_},[e("div",{class:"bg-cyber-panel border border-slate-700 rounded-xl flex flex-col overflow-hidden shadow-lg transition-none",style:M({width:`${C.value}%`})},[s[11]||(s[11]=e("div",{class:"bg-slate-800/80 px-4 py-3 border-b border-slate-700 flex justify-between items-center"},[e("span",{class:"font-bold text-slate-200 text-sm"},"会话列表"),e("span",{class:"text-[10px] text-slate-500 uppercase tracking-wider font-mono"},"List")],-1)),e("div",be,[e("table",ve,[s[10]||(s[10]=e("thead",{class:"sticky top-0 bg-slate-900/95 text-slate-400 z-10 shadow-sm"},[e("tr",null,[e("th",{class:"px-3 py-2 text-left w-16"},"类型"),e("th",{class:"px-3 py-2 text-left"},"URI / 信息"),e("th",{class:"px-3 py-2 text-right w-20"},"大小")])],-1)),e("tbody",null,[(o(!0),a(B,null,E(m.value,t=>(o(),a("tr",{key:t.id,onClick:r=>L(t),class:c(["cursor-pointer border-b border-slate-800/50 transition-colors h-10",u.value?.id===t.id?"bg-blue-900/20 border-l-2 border-l-blue-400":"hover:bg-slate-800/30 border-l-2 border-l-transparent"])},[e("td",{class:c(["px-3 py-2 font-bold",{"text-blue-400":t.method==="POST","text-green-400":t.method==="GET","text-purple-400":t.method==="RESP","text-slate-500":t.method==="TCP"}])},n(t.method),3),e("td",{class:"px-3 py-2 text-slate-300 truncate max-w-[140px]",title:t.uri},n(t.uri||"-"),9,ye),e("td",ge,n((t.payload_len/1024).toFixed(1))+" KB",1)],10,he))),128))])]),m.value.length===0&&!g.value?(o(),a("div",we,n(i.value.length>0&&p.value?"TCP 流已隐藏":"未发现数据流"),1)):y("",!0)])],4),e("div",{class:"w-5 flex flex-col items-center justify-center cursor-col-resize hover:bg-slate-800/0 group z-50 relative flex-shrink-0",onMousedown:S},[...s[12]||(s[12]=[e("div",{class:"h-full w-[1px] border-l border-dashed border-slate-700 group-hover:border-blue-500/50 transition-colors duration-300 my-2"},null,-1)])],32),e("div",me,[u.value?(o(),a("div",_e,[e("div",ke,[e("div",Ce,[e("span",De,"ID "+n(u.value.id),1),u.value.shell_type!=="unknown"?(o(),a("span",je,n(u.value.shell_type.toUpperCase()),1)):y("",!0)]),e("div",Te,n(x.value.length)+" 条消息 ",1)]),e("div",Pe,[w.value?(o(),a("div",ze,[...s[13]||(s[13]=[e("div",{class:"w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mb-2"},null,-1),e("span",{class:"text-xs text-slate-400"},"正在解析流内容...",-1)])])):x.value.length>0?(o(!0),a(B,{key:1},E(x.value,(t,r)=>(o(),a("div",{key:t.seq,class:c(["flex flex-col gap-1 max-w-full animate-fade-in",t.type==="req"?"items-start":"items-end"]),style:M({animationDelay:`${r*.05}s`})},[e("div",Me,[e("span",{class:c(["text-[9px] font-bold uppercase tracking-wider px-1.5 py-0.5 rounded",t.type==="req"?"bg-blue-900 text-blue-300":"bg-green-900 text-green-300"])},n(t.type==="req"?"请求":"响应"),3),e("span",Be,n(t.header_summary),1)]),e("div",{class:c(["w-full max-w-[95%] rounded-lg border shadow-lg overflow-hidden transition-all duration-300 group",t.type==="req"?"bg-[#1c2128] border-blue-900/30":"bg-[#161b22] border-green-900/30"])},[e("div",Ee,[e("div",$e,[e("span",null,n(t.content_len)+" Bytes",1)]),e("button",{onClick:U=>R(t),disabled:t.isDecrypting,class:"flex items-center gap-1.5 px-2 py-1 rounded hover:bg-white/10 text-slate-400 hover:text-white text-[10px] font-bold transition-all disabled:opacity-50"},[t.isDecrypting?(o(),a("div",Ae)):(o(),k(b(G),{key:0,class:"w-3 h-3"})),X(" "+n(t.decryptedData?"重新解密":"解密载荷"),1)],8,Se)]),t.decryptedData&&t.decryptedData.length>0?(o(),a("div",Le,[e("div",qe,[e("div",{class:c(["w-1.5 h-1.5 rounded-full",V(t.decryptedData[0]?.type)])},null,2),e("span",{class:c(["text-xs font-bold",N(t.decryptedData[0]?.type)])},n(t.decryptedData[0]?.title),3)]),e("div",Re,n(t.decryptedData[0]?.content),1)])):y("",!0),e("div",Ve,[e("div",{class:c(["font-mono text-[10px] text-slate-500 whitespace-pre-wrap break-all leading-relaxed transition-all duration-300 select-text cursor-text selection:bg-blue-500/30",t.isExpanded?"max-h-none":"max-h-[120px] overflow-hidden opacity-80"])},n(q(t.raw_b64)),3),!t.isExpanded&&t.content_len>250?(o(),a("div",Ne,[e("button",{onClick:U=>t.isExpanded=!0,class:"text-[9px] text-blue-400 hover:text-blue-300 bg-slate-900/80 px-2 py-0.5 rounded border border-slate-700"},"显示全部",8,Ue)])):y("",!0)])],2)],6))),128)):(o(),a("div",Fe,[...s[14]||(s[14]=[e("span",{class:"text-xs"},"未发现可识别内容",-1)])]))])])):(o(),a("div",Oe,[e("div",Ze,[P(b(H))]),s[15]||(s[15]=e("p",{class:"text-sm font-medium"},"请从左侧选择一个数据流",-1))]))])],512)]))}},Ge=F(Ie,[["__scopeId","data-v-3ee3e951"]]);export{Ge as default};
